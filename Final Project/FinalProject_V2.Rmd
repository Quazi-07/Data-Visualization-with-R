---
title: "FinalProject"
author: "Md. Saifur Rahman"
date: "4/18/2021"
output: word_document
---



```{r setup the working directory, include=FALSE}
setwd("C:/Users/mdsaifur.rahman.1/Desktop/Spring 2021/EFR 535/Code R")

```

```{r load package, include=FALSE}
library(ggplot2)
library(tidyverse)
library(psych) # basic calculation
library(ggcorrplot) # correlation heat map
library(GGally) # Correlation matrix with extra visuals
library(hexbin) # Hexagon bin scatterplot
library(apaTables) # correlation matrix in APA format
library(scales)
library(ggridges)
```

```{r set all theme as classic from ggplot2, include=FALSE}
theme_set(theme_classic())
```

#  **Task-1: Review the data file. Tidy and manage the data (e.g., variable names) as needed to prepare for analysis.Briefly explain what you did and why.**

***

## **Answer:** Write step by step 

```{r load data, view data and attach the data}
library(readxl)
Data <- read_excel("Tidy Chemistry Data.xlsx", 
    na = "NA")
View(Data)
attach(Data)
```

#  **Task-2: Who were the students in this class? Visualize student characteristics by gender, program, and level.**

***

## **Answer:** (i) According to gender, highest number of students are female in this class.(ii) According to the program, "Nursing/Pre-Nursing" is the largest group in this class.(iii) According to level, the largest group of students is in their "Freshman" year. The complete visualization is given in the following. 

```{r Visualize student characteristics by gender, program, and level}
# (i) Visualize student characteristics by gender.

# Visualize student characteristics by gender. I get that a few students didn't insert gender identity in the "Gender" column. Hence, visualizing NA too! 
ggplot(Data, aes(Gender))+geom_bar(fill="cyan", alpha = 0.3, color="blue")



# (ii) Visualize student characteristics by program.

# Visualize student characteristics by program. It's hard to read the labels of x-axis.I need to flip the co-ordinate of this plot.
ggplot(Data, aes(Program))+geom_bar(fill="blue", color="red", alpha = 0.5)

# Flip the plot and draw a horizontal bar chart.
ggplot(Data, aes(Program))+geom_bar(fill="blue", color="red", alpha = 0.5)+ coord_flip()


# (iii) Visualize student characteristics by level.


# Visualize student characteristics by level. I get 6 levels while having two group in the freshman and sophomore. It's a capital case issue. A few students insert sophomore starting with lowercase "s" which should be always uppercase "S". Again, the same occurs in the group of freshman level. That's why get 6 level instead of 4. I need to convert first letter of these values into uppercase to solve this issue. 
ggplot(Data, aes(Level))+geom_bar()

# Capitalize first letter of each value from the "Level" to avoid "Sophomore/sophomore", "Freshman/freshman" letter case issue.
#?toupper
capFirst <- function(s) {paste(toupper(substring(s, 1, 1)), substring(s, 2), sep = "")}
Data$Level <- capFirst(Data$Level)

# Again, Visualize student characteristics by level. Now, this works as expected.
ggplot(Data, aes(Level))+geom_bar(fill="lightgreen", alpha = 0.3, color="blue")
```

#  **Task-3: How were the students evaluated in this class? Visualize the composition of the final course grade: exams, online “Mastering Chemistry” (MC), in class “Team”, “Exam Review” sessions, peer evaluations, etc. **

***

## **Answer:** The given data file is ambiguous in terms of totals course points. It shows total points for this course is 882 but when I add all individual points elements, I get 692 as a total! So, I decided to be consistent with the total getting from individual elements. Elements are as follows, (1) Points_for_Final = 150, (2) Raw_Final = 60, (3) Exams (1+2+3+4) = 131, (4) Mastering_Chemistry_total(Mastering_Chemistry_module+Mastering_Chemistry_HW+Mastering_Chemistry_quiz) = 157, (5) Team_points(Team_report_total+Team_quiz_total+Team_survey) = 106, (6) Exam_review = 45, (7) Peer-evalution (Peer_evalution+ peer_feedback) = 31, (8) DSM+intro_quiz+selfi = 12. I am following this setup for visualizaing the composition of the final course grade.

```{r How were the students evaluated in this class?}
# Visualize the composition of the final course grade
# Create a new data frame. 
Data_eval <- data.frame( Course_elements = c("Points_for_Final", "Raw_Final", "Exams", "Mastering_Chemistry_total","Team_points",       
                                             "Exam_review", "Peer-evalution", "DSM+intro_quiz+selfi"),
                         total_point = c(150,60,131,157,106,45,31,12))
view(Data_eval)

# Draw stacked barplot. without color stacked barplot is impossible to read.
ggplot(Data_eval, aes(x="", y=total_point))+ geom_bar(stat = "identity")


# Add color to understand stacked barplot
ggplot(Data_eval, aes(x="", y=total_point, fill=Course_elements))+ geom_bar(stat = "identity")


# Change colors of the bars. I am using 'scale_fill_brewer()' to change the color of bars.Use 'reorder()' function to reorder the stacks in the bar.
ggplot(Data_eval, aes(x="", y=total_point, fill=reorder(Course_elements,total_point)))+ geom_bar(stat = "identity")+ scale_fill_brewer(palette = "Set3")


# Add data labels to them. Use 'geom_text()' to add value labels, modify color, modify size, and position of the labels.
ggplot(Data_eval, aes(x="", y=total_point, fill=reorder(Course_elements,total_point)))+ geom_bar(stat = "identity")+ scale_fill_brewer(palette = "Set3") + geom_text(aes(label=total_point),size=3.5, color="black", position = position_stack(vjust = 0.5))

# Add a title for the chart and center it. Use 'ggtitle()' function to add a title. Use 'theme()' function to modify size of the title, chanhe title color, and center the title in this plot.Use "labs()" to rename the legend.
ggplot(Data_eval, aes(x="", y=total_point, fill=reorder(Course_elements,total_point)))+ geom_bar(stat = "identity")+ scale_fill_brewer(palette = "Set3") + geom_text(aes(label=total_point),size=3.5, color="black", position = position_stack(vjust = 0.5))+ ggtitle("Visualize the Composition of the Final Course Grade") + theme(plot.title = element_text(hjust = 0.5,size = 15, color = "red")) + labs(fill="Course_element")
```


#  **Task-4: How did the students perform in the class overall? Visualize the proportion of the letter grades and the distribution of the total course points. **

***

```{r How did the students perform in the class overall?}
# (i) Visualize the proportion of the letter grades

# Visualize the proportion of the letter grades using bar chart
ggplot(Data, aes(Grade))+geom_bar(fill="cyan", alpha = 0.3, color="blue")

# Visualize the proportion of the letter grades using pie chart
ggplot(Data, aes(factor(1), fill= Grade))+geom_bar(width = 1) + coord_polar("y")
ggplot(Data, aes(factor(1), fill= Grade))+geom_bar(width = 1) + coord_polar("y")+ scale_fill_brewer("Blues")



# Modify the pie chart. Add a title using ggtitle(). Use theme() to remove x-axis title, y-axis title, axis line and some modification in the plot title.
ggplot(Data, aes(factor(1), fill= Grade))+geom_bar(width = 1) + coord_polar("y") + ggtitle("The proportion of the letter grades") + theme(axis.title.x = element_blank(),axis.title.y = element_blank(), axis.line = element_blank(),axis.ticks = element_blank(), plot.title=element_text( size=12, face="bold", color = "red", hjust = 0.5)) 


# Add percentage/label to each pie slices.
# Create a new variable "Grade_count" to count each group in the grade column. Use "group_by()" and "summarize()" function to count the number in each grade.Then,create another variable "Grade_percent" to insert percent value in the "Grade_count" data frame. Use 'percent()' unction to convert percent value into percent presentation. Use 'round()' function to select 3 values after decimal point.

Grade_count <- group_by(Data,Grade) %>% summarise( number_rows = n()) 
view(Grade_count)
#Grade_percent <- round((Grade_count$number_rows)/sum(Grade_count$number_rows),2)
#view(Grade_percent)
Grade_count$Grade_percent <- round((Grade_count$number_rows)/sum(Grade_count$number_rows),2)

# Now, draw the same pie chart again but this time use newly created "Grade_count" data frame to show the percent label. Use "geom_text()" and "percent()" function to show the percent label. 
ggplot(Grade_count, aes(x="", y= number_rows, fill= Grade))+ geom_bar(stat = "identity")+ scale_fill_brewer(palette = "Spectral")+coord_polar(theta = "y", start = 0) + labs(x=NULL,y=NULL,title="The proportion of the letter grades") + theme(axis.line = element_blank(),axis.text = element_blank(),plot.title = element_text(hjust = 0.5,size = 15,color = "blue"))+ geom_text(aes(label=scales::percent(round(Grade_percent,3))), position = position_stack(vjust = 0.5),size=4)


# Reorder the slices from largest to smallest starting at 12 o’clock. Use 'reorder()' function to reorder the slices. Rename legend title using labs( fill = "Grade")
ggplot(Grade_count, aes(x="", y= number_rows, fill= reorder(Grade,-Grade_percent)))+ geom_bar(stat = "identity")+ scale_fill_brewer(palette = "Spectral")+coord_polar(theta = "y", start = 0) + labs(x=NULL,y=NULL,title="The proportion of the letter grades") + theme(axis.line = element_blank(),axis.text = element_blank(),plot.title = element_text(hjust = 0.5,size = 15, color = "blue"))+ geom_text(aes(label=scales::percent(round(Grade_percent,3))), position = position_stack(vjust = 0.5),size=4) + labs(fill= "Grade")


# (ii) Visualize the distribution of the total course points



# Visualize the distribution of the total course points using scatter plot. Scatter plot doesn't give a good visualization. 
ggplot(Data, aes(Student,`Total_Score(882)`))+geom_point()


# Visualize the distribution of the total course points using histogram. Modify x-axis ticks using "scale_x_continuous()" function. 
ggplot(Data, aes(`Total_Score(882)`))+geom_histogram()+ scale_x_continuous(breaks = round(seq(min(Data$`Total_Score(882)`), max(Data$`Total_Score(882)`), by = 50))) 

# Add color and fill attributes to make this histogram more attractive. Set binwidth=30 to reduce number of bins. Using alpha to control transparency
ggplot(Data, aes(`Total_Score(882)`))+geom_histogram(color="red", fill="cyan4", binwidth=30, alpha=0.5)+ scale_x_continuous(breaks = round(seq(min(Data$`Total_Score(882)`), max(Data$`Total_Score(882)`), by = 50))) 


# Visualize the distribution of the total course points density plot. Modify x-axis ticks using "scale_x_continuous()" function.
ggplot(Data, aes(`Total_Score(882)`))+geom_density() + scale_x_continuous(breaks = round(seq(min(Data$`Total_Score(882)`), max(Data$`Total_Score(882)`), by = 50))) 

# Modiy color, fill the shape, color the outline etc.
ggplot(Data, aes(`Total_Score(882)`))+geom_density(color="red", fill="cyan4", alpha=0.5) + scale_x_continuous(breaks = round(seq(min(Data$`Total_Score(882)`), max(Data$`Total_Score(882)`), by = 50)))

# Adjust the shape
ggplot(Data, aes(`Total_Score(882)`))+geom_density(adjust = 2,color="red", fill="cyan4", alpha=0.5) + scale_x_continuous(breaks = round(seq(min(Data$`Total_Score(882)`), max(Data$`Total_Score(882)`), by = 50))) 
```

#  **Task-5: How effectively did students participate in class during “Team” activities (daily group activities in class among three students, includes quizzes and reports)? Visualize the distribution of student Team work. How did Team activity performance relate to exam performance? **

***

```{r How effectively did students participate in class during “Team” activities?}

# (i) Visualize the distribution of student Team work

# Visualize the distribution of student Team work (Report+Quiz) using histogram. 
ggplot(Data, aes(`Team performance (105)`))+geom_histogram()

# Add color and fill attributes to make this histogram more attractive. Set binwidth=30 to reduce number of bins. Using alpha to control transparency. Modify x-axis ticks using "scale_x_continuous()" function. 
ggplot(Data, aes(`Team performance (105)`))+geom_histogram(color="blue", fill="darkviolet", binwidth=7, alpha = 0.7)+ scale_x_continuous(breaks = round(seq(min(Data$`Team performance (105)`), max(Data$`Team performance (105)`), by = 10)))

# Visualize the distribution of student Team work (Report+Quiz) using frequency polygon. Add red color in line.Add bins number to make this line smoother
ggplot(Data, aes(`Team performance (105)`))+geom_freqpoly(color="red", bins=10)




# (ii) How did Team activity performance relate to exam performance?

# Visualize the relation between Team activity performance and exam performance using scatter plot
ggplot(Data, aes(`Total_Score(882)`,`Team performance (105)`))+geom_point()

# Visualize the relation between Team activity performance and exam performance using a smooth line
ggplot(Data, aes(`Total_Score(882)`,`Team performance (105)`))+geom_smooth()


# Correlation graph. Create subset with continuous variable form the original dataset.
Data_cor <- subset(Data, select = c("Team_Report_total(58)","Team_Quiz_total(47)", "Team performance (105)", "Total_Score(882)"))

# Round the data and consider 1 value after decimal point for correlation
Data_cor_round <- round(cor(Data_cor),1)

# Visualize the correlation matrix. method = "square" (default)
ggcorrplot(Data_cor_round)

# Add Correlation label.
ggcorrplot(Data_cor_round, lab = TRUE)

# method = "circle"
ggcorrplot(Data_cor_round, method = "circle", lab = TRUE)


# Use hierarchical clustering.
ggcorrplot(Data_cor_round, hc.order = TRUE, type = "upper", lab=TRUE, lab_size = 3, outline.col = "white")

# Correlation Using APA format from apaTables package.
apa.cor.table(Data_cor_round, filename = NA,table.number = NA, show.conf.interval = FALSE,landscape = TRUE)
```

#  **Task-6: Visualize the distribution of engagement among students outside of class in the online “Mastering Chemistry” (MC). Is greater MC performance related to better student performance on exams? **

***

```{r}
# Visualize the distribution of engagement among students outside of class in the online “Mastering Chemistry” (MC)
ggplot(Data, aes(Student, `MC_Performance(154)`))+geom_point()

Data$Exam_performance <- sum(Data$`Exam_1(35)`,Data$`Exam_2(31)`,Data$`Exam_3(31)`,Data$`Exam_4(34)`)

view(Data$Exam_performance )
# Is greater MC performance related to better student performance on exams?
ggplot(Data, aes(`MC_Performance(154)`, Exam_performance))+geom_point()
ggplot(Data, aes(`MC_Performance(154)`, Exam_performance))+geom_smooth()
```

#  **Task-7: Were any types of students more/less active on Blackboard? Was Blackboard MC activity related to Homework Points, Quiz Points, or Final Course grade? **

***

```{r Were any types of students more/less active on Blackboard?}
# Were any types of students more/less active on Blackboard? Plotting multiple distribution.x axis is continuous variable and y axis (fill) is categorical variable. 
# density plot
ggplot(Data, aes(BB_Total_Usage, fill= Gender)) + geom_density()

# Modify plot appearance for Density plots. (i) Add outline color, fill color and transparency. Adjust=1, make some adjustment in the plot. I am considering "NA" i.e missing gender because that's also a large group in this dataset!!
ggplot(Data, aes(BB_Total_Usage, fill= Gender, color=Gender)) + geom_density(adjust=1, alpha=0.3)

# Violin plot
ggplot(Data, aes(Gender,BB_Total_Usage)) + geom_violin()

# Modify plot appearance for Violin plot.(i) fill=Gender, fill each violin plot based on gender; (ii) color=“green”, draw outline color for each violin plot as green.
ggplot(Data, aes(Gender,BB_Total_Usage,fill=Gender)) + geom_violin()
```

#  **Task-8: What related more strongly to final exam score: online MC performance, in class Team performance, Exam Review sessions? Visualize these relationships and report on their correlations. Fun bonus: What are some other variables, if any, that relate to final exam performance other than those listed? **

***

## **Answer:** The "Team performance" and "MC_Performance" are equally and most strongly corelated with the final exam score (Total_Score). The corellation among these are 0.8 


```{r}
# Correlation graph. Create subset with continuous variable form the original dataset.
Data_corExam <- subset(Data, select = c("MC_Performance(154)","Team performance (105)", "Total_Score(882)", "Exam_Review(45)"))

# Round the data and consider 1 value after decimal point for correlation
Data_cor_round_Exam <- round(cor(Data_corExam),1)

# Visualize the correlation matrix. method = "square" (default)
ggcorrplot(Data_cor_round_Exam)

# Add Correlation label.
ggcorrplot(Data_cor_round_Exam, lab = TRUE)

# method = "circle"
ggcorrplot(Data_cor_round_Exam, method = "circle", lab = TRUE)


# Use hierarchical clustering.
ggcorrplot(Data_cor_round_Exam, hc.order = TRUE, type = "upper", lab=TRUE, lab_size = 3, outline.col = "white")
```

#  **Task-9: How did the Starfish messages translate into student performance in the course overall? Fun bonus: What are some variables the instructor could use to identify students early on who struggling and performed poorly in the course in the end? **

***

## **Answer:** 


```{r}


ggplot(Data, aes(`Total_Score(882)`,StarFish_9.12, fill= StarFish_9.12)) + geom_violin()
ggplot(Data, aes(`Total_Score(882)`,StarFish_9.12, fill= StarFish_9.12)) + geom_boxplot()
ggplot(Data, aes(`Total_Score(882)`,Starfish_10.5, fill= Starfish_10.5)) + geom_violin()
ggplot(Data, aes(`Total_Score(882)`,Starfish_10.5, fill= Starfish_10.5)) + geom_boxplot()


```

#  **Task-10: How did students’ performance change over time, if at all? Visualize any two of the following variables over time: (a) Team reports, (b) MC quizzes, (c) MC homework, and (d) exams. Fun bonus: Did students who completed the SELFI perform better or worse in the course than students who did not complete the SELFI? **

***

## **Answer:** 

```{r}
# students’ performance change over time exams
ggplot(Data, aes(Student, `Team performance (105)`))+ geom_smooth()

# Create a new data frame with all students and all four exams.
Data_perform_all <- select(Data, Student,`Exam_1(in %)`, `Exam_2(in %)`, `Exam_3(in %)`,`Exam_4(in %)`)
view(Data_perform_all)

# Draw a line graph to see students(all) performance change over time on the all 4 exams. This chart is ugly!, I need to reduce students number to draw a more understandable chart. 
Data_perform_all %>%
  mutate(row_number = as.factor(row_number())) %>%
  gather(Exams, Points, `Exam_1(in %)`:`Exam_4(in %)`) %>%
  ggplot(aes(x = Exams, y = Points, group = row_number, color = row_number)) +
  geom_line() + geom_point() + labs(fill = "Student")


# Create a new data frame with only first 10 students and all four exams.
Data_perform_10 <- filter(Data, Student== c(1:10)) %>% select(Student,`Exam_1(in %)`, `Exam_2(in %)`, `Exam_3(in %)`,`Exam_4(in %)`)
view(Data_perform_10)

# Draw a line graph to see students(10) performance change over time on the all 4 exams. This make sense!
Data_perform_10 %>%
  mutate(row_number = as.factor(row_number())) %>%
  gather(Exams, Points, `Exam_1(in %)`:`Exam_4(in %)`) %>%
  ggplot(aes(x = Exams, y = Points, group = row_number, color = row_number)) +
  geom_line() + geom_point() + labs(fill = 'Student')

# Create a new data frame with only first 10 students and all MC Quizzes.
Data_perform_10_Quiz <- filter(Data, Student== c(1:1)) %>% select(Student, `Quiz1(1.5)`:`Quiz27(1.5)`)
view(Data_perform_10_Quiz)

# Draw a line graph to see students(10) performance change over time on the all MC quizzes. This graph is ugly with 10 student points over time. It's even complex with only 2 students!! So let's stick with only one student in this case!
Data_perform_10_Quiz %>%
  mutate(row_number = as.factor(row_number())) %>%
  gather(MC_Quizzes, Points, `Quiz1(1.5)`:`Quiz27(1.5)`) %>%
  ggplot(aes(x = MC_Quizzes, y = Points, group = row_number, color = row_number)) +
  geom_line() + geom_point() + labs(fill = 'Student')
```

